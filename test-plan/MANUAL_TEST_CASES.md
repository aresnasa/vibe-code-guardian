# Vibe Code Guardian - 完整测试用例文档

## 测试概述

本文档包含 Vibe Code Guardian 插件的完整测试用例，覆盖以下功能：
- 代码变化追踪
- 检查点创建
- 回滚功能
- Git 集成
- UI 交互

---

## 一、自动化测试 (run-tests.sh)

运行方式：
```bash
cd /Users/aresnasa/MyProjects/go/src/github.com/aresnasa/vibe-code-guardian/test-plan
chmod +x run-tests.sh
./run-tests.sh
```

自动化测试覆盖 15 个核心场景。

---

## 二、手动测试用例

### 测试环境准备

1. 安装最新版 VSIX：
   ```
   vibe-code-guardian-0.1.1.vsix
   ```

2. 创建测试项目：
   ```bash
   mkdir ~/test-vibe-manual
   cd ~/test-vibe-manual
   code .
   ```

---

### 测试用例 M01: 插件激活

**目的**: 验证插件正确激活

**步骤**:
1. 打开一个新的空文件夹作为工作区
2. 查看底部状态栏

**预期结果**:
- [ ] 显示 "🎮 Vibe Code Guardian activated!" 通知
- [ ] 状态栏显示 Vibe Guardian 图标
- [ ] 侧边栏出现 Vibe Guardian 视图

---

### 测试用例 M02: Git 仓库自动初始化

**目的**: 验证自动初始化 Git 仓库

**步骤**:
1. 打开一个没有 .git 的文件夹
2. 观察是否提示初始化 Git

**预期结果**:
- [ ] 如果没有 Git 仓库，提示初始化
- [ ] 初始化后创建 .git 目录
- [ ] 创建初始 commit

---

### 测试用例 M03: 手动保存检查点

**目的**: 验证手动创建检查点功能

**步骤**:
1. 创建文件 `test.js`:
   ```javascript
   function hello() {
       console.log("Hello");
   }
   ```
2. 按 `Cmd+Shift+P` 运行 "Vibe Guardian: Save Checkpoint"
3. 输入检查点名称 "Initial hello function"

**预期结果**:
- [ ] 显示 "💾 Checkpoint saved" 通知
- [ ] 侧边栏时间线显示新检查点
- [ ] Git log 显示新 commit

**验证命令**:
```bash
git log --oneline -1
# 应显示类似: abc1234 [Vibe Guardian] 💾 Initial hello function
```

---

### 测试用例 M04: 文件修改追踪

**目的**: 验证文件修改被正确追踪

**步骤**:
1. 修改 `test.js`:
   ```javascript
   function hello(name) {
       console.log("Hello, " + name);
   }
   ```
2. 保存文件
3. 创建新检查点 "Added name parameter"

**预期结果**:
- [ ] 检查点记录 1 个文件变化
- [ ] 检查点显示 +/- 行数统计

---

### 测试用例 M05: 查看 Diff

**目的**: 验证 diff 查看功能

**步骤**:
1. 在时间线中找到上一个检查点
2. 右键点击选择 "View Diff"

**预期结果**:
- [ ] 打开 VS Code diff 视图
- [ ] 左侧显示旧版本，右侧显示新版本
- [ ] 正确高亮显示变化行

---

### 测试用例 M06: 基本回滚 (Rollback)

**目的**: 验证通过检查点回滚

**步骤**:
1. 确保有多个检查点
2. 记录当前 `test.js` 内容
3. 右键点击较早的检查点，选择 "Rollback"
4. 确认回滚

**预期结果**:
- [ ] 显示确认对话框
- [ ] 回滚成功后显示通知
- [ ] 文件内容恢复到该检查点状态
- [ ] 编辑器自动刷新显示新内容

---

### 测试用例 M07: Time Machine 功能

**目的**: 验证直接从 Git 历史回滚

**步骤**:
1. 按 `Cmd+Shift+P` 运行 "Vibe Guardian: Time Machine"
2. 从列表中选择一个历史 commit
3. 确认回滚

**预期结果**:
- [ ] 显示所有 Git commit 历史
- [ ] 每个 commit 显示 hash、消息、时间
- [ ] 回滚后文件内容变化
- [ ] 显示 "detached HEAD" 相关提示

---

### 测试用例 M08: 返回最新状态

**目的**: 验证从历史状态返回最新

**步骤**:
1. 使用 Time Machine 回滚到历史版本
2. 运行 "Vibe Guardian: Return to Latest State"

**预期结果**:
- [ ] 成功返回 master/main 分支
- [ ] 文件恢复到最新状态
- [ ] 显示成功通知

---

### 测试用例 M09: 多文件变化追踪

**目的**: 验证同时修改多个文件

**步骤**:
1. 创建 3 个新文件：
   - `a.js`: `const a = 1;`
   - `b.js`: `const b = 2;`
   - `c.js`: `const c = 3;`
2. 创建检查点 "Created a, b, c"
3. 修改全部 3 个文件
4. 创建检查点 "Modified all"

**预期结果**:
- [ ] 第一个检查点显示 3 个文件添加
- [ ] 第二个检查点显示 3 个文件修改
- [ ] 回滚能恢复所有 3 个文件

---

### 测试用例 M10: 文件删除追踪

**目的**: 验证删除文件被追踪

**步骤**:
1. 删除 `c.js` 文件
2. 创建检查点 "Deleted c.js"
3. 使用 Time Machine 回滚到删除前

**预期结果**:
- [ ] 检查点记录文件删除
- [ ] 回滚后 `c.js` 文件恢复

---

### 测试用例 M11: 文件重命名追踪

**目的**: 验证重命名文件被追踪

**步骤**:
1. 将 `a.js` 重命名为 `alpha.js`
2. 创建检查点 "Renamed a to alpha"
3. 查看检查点详情

**预期结果**:
- [ ] 检查点显示重命名操作
- [ ] 回滚后恢复原文件名

---

### 测试用例 M12: 大文件变化

**目的**: 验证大量代码变化的追踪

**步骤**:
1. 创建包含 200 行代码的文件
2. 创建检查点
3. 修改超过 100 行
4. 创建新检查点
5. 查看 diff

**预期结果**:
- [ ] 所有变化被正确追踪
- [ ] Diff 正确显示所有变化行
- [ ] 回滚正确恢复所有内容

---

### 测试用例 M13: 快速连续变化

**目的**: 验证快速连续保存

**步骤**:
1. 在 5 秒内创建 5 个检查点
2. 检查时间线

**预期结果**:
- [ ] 所有 5 个检查点都被创建
- [ ] 每个检查点有唯一 ID
- [ ] 可以回滚到任意一个

---

### 测试用例 M14: 清理历史功能

**目的**: 验证清理无效检查点

**步骤**:
1. 创建多个检查点
2. 手动删除一些被追踪的文件
3. 运行 "Vibe Guardian: Cleanup Invalid History"

**预期结果**:
- [ ] 显示清理结果
- [ ] 只删除真正无法回滚的检查点
- [ ] 保留有 Git commit 的检查点

---

### 测试用例 M15: 调试信息查看

**目的**: 验证调试命令

**步骤**:
1. 运行 "Vibe Guardian: Debug: Show Checkpoint Details"

**预期结果**:
- [ ] Output 面板显示详细信息
- [ ] 列出所有检查点
- [ ] 显示每个检查点的 gitCommitHash
- [ ] 显示 Git 历史对比

---

### 测试用例 M16: 会话管理

**目的**: 验证会话创建和管理

**步骤**:
1. 运行 "Vibe Guardian: Start New Session"
2. 输入会话名称 "Feature: User Auth"
3. 创建几个检查点
4. 查看时间线分组

**预期结果**:
- [ ] 新会话创建成功
- [ ] 检查点归属于当前会话
- [ ] 时间线正确显示会话分组

---

### 测试用例 M17: 边界情况 - 空工作区

**目的**: 验证空工作区处理

**步骤**:
1. 打开空文件夹
2. 尝试创建检查点（无任何文件）

**预期结果**:
- [ ] 不崩溃
- [ ] 显示适当的提示信息

---

### 测试用例 M18: 边界情况 - 大型仓库

**目的**: 验证大型仓库性能

**步骤**:
1. 打开一个有 100+ commits 的仓库
2. 使用 Time Machine

**预期结果**:
- [ ] 加载速度可接受（< 3秒）
- [ ] 列表正确显示所有 commits
- [ ] 滚动流畅

---

### 测试用例 M19: 冲突场景

**目的**: 验证未提交更改的处理

**步骤**:
1. 修改文件但不保存检查点
2. 尝试使用 Time Machine 回滚

**预期结果**:
- [ ] 提示有未保存的更改
- [ ] 自动保存或 stash 当前更改
- [ ] 回滚后可以恢复之前的更改

---

### 测试用例 M20: 状态栏功能

**目的**: 验证状态栏信息和交互

**步骤**:
1. 观察状态栏 Vibe Guardian 区域
2. 点击状态栏图标

**预期结果**:
- [ ] 显示当前检查点数量或状态
- [ ] 点击后显示快捷菜单或打开时间线

---

## 三、性能测试

### P01: 检查点创建性能
- 创建检查点应在 < 2秒 完成
- 大型仓库（1000+ 文件）应在 < 5秒 完成

### P02: 回滚性能
- 简单回滚应在 < 3秒 完成
- 涉及大量文件的回滚应在 < 10秒 完成

### P03: 时间线加载性能
- 100 个检查点加载应在 < 1秒
- 滚动应保持 60fps

---

## 四、错误处理测试

### E01: Git 未安装
- 应提示安装 Git
- 不应崩溃

### E02: 网络断开
- 所有本地操作应正常工作
- 不应有网络相关错误

### E03: 磁盘空间不足
- 应显示友好错误信息
- 不应损坏现有数据

---

## 五、测试结果记录表

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| M01 | ⬜ | |
| M02 | ⬜ | |
| M03 | ⬜ | |
| M04 | ⬜ | |
| M05 | ⬜ | |
| M06 | ⬜ | |
| M07 | ⬜ | |
| M08 | ⬜ | |
| M09 | ⬜ | |
| M10 | ⬜ | |
| M11 | ⬜ | |
| M12 | ⬜ | |
| M13 | ⬜ | |
| M14 | ⬜ | |
| M15 | ⬜ | |
| M16 | ⬜ | |
| M17 | ⬜ | |
| M18 | ⬜ | |
| M19 | ⬜ | |
| M20 | ⬜ | |

状态图例：✅ 通过 | ❌ 失败 | ⬜ 未测试 | 🔄 进行中
